"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9023],{96726:function(e,t,n){let r;n.d(t,{a:function(){return ec},b:function(){return M},bD:function(){return ev},bF:function(){return et},bK:function(){return em},bM:function(){return ep},bd:function(){return R},be:function(){return Q},bf:function(){return Y},bv:function(){return ew},bw:function(){return eg},bz:function(){return es},c:function(){return U},d:function(){return N},e:function(){return $},f:function(){return _},g:function(){return A},h:function(){return Z},i:function(){return O},j:function(){return F},l:function(){return W},n:function(){return el},p:function(){return ed},q:function(){return eh},t:function(){return ef},u:function(){return L},w:function(){return b}}),n(58499);var i=n(70165),a=n(55764),o=n(64874),c=n(35171),u=n(2752),s=n(22130),l=n(2265),d=(n(5572),n(46795)),h=n(18994),f=n(57437),w=n(16211),g=n(63112),v=n(25621),p=n(89515),m=n(79108);n(9581);let C=(0,l.createContext)(void 0),y=(0,l.createContext)(void 0);function b(){return(0,l.useContext)(y)}let I="lastConnectedWallet",P=new Map,S=(0,l.createContext)(void 0);function T(e){let[t,n]=(0,l.useState)(void 0),[i,a]=(0,l.useState)("unknown"),o=e.autoConnectTimeout||15e3,[c,u]=(0,l.useState)(),[s,d]=(0,l.useState)(),[h,w]=(0,l.useState)();r||(r=e.createWalletStorage("coordinatorStorage"));let g=e.autoSwitch?e.activeChain:void 0,v=(0,l.useMemo)(()=>({chains:e.chains,dappMetadata:e.dAppMeta,chain:e.activeChain||e.chains[0],clientId:e.clientId}),[e.chains,e.dAppMeta,e.activeChain,e.clientId]),m=(0,l.useCallback)(e=>{let t=e.create(v);return t.walletId===p.w.magicLink&&d(t),P.set(t,e),t},[v]);(0,l.useEffect)(()=>{c&&c.updateChains(e.chains)},[c,e.chains]);let C=(0,l.useCallback)(async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];u(e);let i=P.get(e);if(!i)throw Error("Wallet config not found for given wallet instance. Do not create a wallet instance manually - use the useCreateWalletInstance() hook instead");w(i),a("connected");let o=await e.getSigner();if(n(o),r)return;let c={walletId:i.id,connectParams:t||e.getConnectParams()},s=e.getPersonalWallet(),l=P.get(s);s&&l&&(c.connectParams={...c.connectParams,personalWallet:{walletId:l.id,connectParams:s.getConnectParams()}}),x(c)},[]),y=(0,l.useCallback)(async e=>{let t=await r.getItem(I);if(t)try{let n=JSON.parse(t);n.connectParams?n.connectParams.chainId=e:n.connectParams={chainId:e},await r.setItem(I,JSON.stringify(n))}catch(e){console.error(`Error saving the last active chain: ${e}`)}},[]),b=(0,l.useCallback)(async e=>{if(!c)throw Error("No active wallet");await c.switchChain(e);let t=await c.getSigner();await y(e),n(t)},[c,y]),T=(0,l.useRef)(!1);(0,l.useEffect)(()=>{if(!e.signerWallet&&!T.current){if(!1===e.shouldAutoConnect){a("disconnected");return}c||"unknown"!==i||(T.current=!0,async function(){let t=await k();if(!t){a("disconnected");return}let n=e.supportedWallets.find(e=>e.id===t.walletId);if(!n){a("disconnected");return}let i=t.connectParams?.personalWallet;if(i){let e=n.personalWallets||[],r=e.find(e=>e.id===i.walletId);if(r){let e=m(r);try{await j(e.autoConnect(i.connectParams),{ms:o,message:E})}catch(e){console.error("Failed to auto connect personal wallet"),console.error(e),a("disconnected");return}t.connectParams={...t.connectParams,personalWallet:e}}else{a("disconnected");return}}let c=m(n);try{a("connecting"),await j(c.autoConnect(t.connectParams),{ms:o,message:E}),C(c,t.connectParams,!0)}catch(e){console.error("Failed to auto connect wallet"),console.error(e),e instanceof Error&&e.message===E&&r.removeItem(I),a("disconnected")}}())}},[m,e.supportedWallets,C,e.shouldAutoConnect,c,i,o,e.signerWallet]);let W=(0,l.useCallback)(async function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[r,i]=t,o={chainId:g?.chainId,...i||{}},c=m(r);a("connecting");try{r.id===p.w.magicLink&&x({walletId:r.id,connectParams:o}),await c.connect(o),C(c,o)}catch(e){throw console.error(`Error connecting to wallet: ${e}`),a("disconnected"),e}return c},[m,C,g]),L=(0,l.useCallback)(async()=>{await r.removeItem(I),a("disconnected"),n(void 0),u(void 0),w(void 0)},[]),Z=(0,l.useCallback)(async()=>{if(!c){L();return}let e=c.getPersonalWallet();await c.disconnect(),e&&await e?.disconnect(),L()},[c,L]);(0,l.useEffect)(()=>{if(!c)return;let e=async()=>{let e=await c.getSigner();n(e)};return c.addListener("change",()=>{e()}),c.addListener("disconnect",()=>{L()}),()=>{c.removeListener("change"),c.removeListener("disconnect")}},[c,L]);let A=(0,l.useRef)();return(0,l.useEffect)(()=>{if(!e.signerWallet){A.current&&(Z(),A.current=void 0);return}if(A.current===e.signerWallet)return;let t=m(e.signerWallet);C(t),A.current=e.signerWallet},[m,e.supportedWallets,C,e.signerWallet,Z]),(0,f.jsx)(S.Provider,{value:{disconnect:Z,wallets:e.supportedWallets,connect:W,signer:t,activeWallet:c,activeWalletConfig:h,connectionStatus:i,setConnectionStatus:a,createWalletInstance:m,createdWalletInstance:s,createWalletStorage:e.createWalletStorage,switchChain:b,setConnectedWallet:C,activeChain:e.activeChain,chainToConnect:g,getWalletConfig:e=>P.get(e),activeChainSetExplicitly:e.activeChainSetExplicitly,clientId:e.clientId},children:e.children})}function W(){let e=(0,l.useContext)(S);if(!e)throw Error("useWalletContext() can only be used inside <ThirdwebProvider />");return e}async function k(){let e=await r.getItem(I);if(!e)return null;try{return JSON.parse(e)}catch{return await r.removeItem(I),null}}async function x(e){try{await r.setItem(I,JSON.stringify(e))}catch(e){console.error("Error saving the last connected wallet info",e)}}function j(e,t){return new Promise((n,r)=>{let i=setTimeout(()=>{r(Error(t.message))},t.ms);e.then(e=>{clearTimeout(i),n(e)},e=>{clearTimeout(i),r(e)})})}let E="Failed to Auto connect. Auto connect timed out. You can increase the timeout duration using the autoConnectTimeout prop on <ThirdwebProvider />";function L(e){let t=W();(0,s.Z)(t,"useWallet() hook must be used within a <ThirdwebProvider/>");let n=t.activeWallet;if(n&&(!e||n.walletId===e))return n}function Z(){let e=W();return(0,s.Z)(e,"useWallet() hook must be used within a <ThirdwebProvider/>"),e.activeWalletConfig}function A(){let e=W();return(0,s.Z)(e,"useWallets() hook must be used within a <ThirdwebProvider/>"),e.wallets}function M(){let e=W();return(0,s.Z)(e,"useConnect() hook must be used within a <ThirdwebProvider/>"),e.connect}function $(){let e=W();return(0,s.Z)(e,"useDisconnect() hook must be used within a <ThirdwebProvider/>"),e.disconnect}function U(){let e=W();return(0,s.Z)(e,"useConnectionStatus() must be used within a <ThirdwebProvider/>"),e.connectionStatus}function O(){let e=W();return(0,s.Z)(e,"useSetConnectionStatus() must be used within a <ThirdwebProvider/>"),e.setConnectionStatus}function N(){let e=W();return(0,s.Z)(e,"useCreateWalletInstance() must be used within a <ThirdwebProvider/>"),e.createWalletInstance}function _(){let e=W();return(0,s.Z)(e,"useSwitchChain() must be used within a <ThirdwebProvider/>"),e.switchChain}function F(){let e=W();return(0,s.Z)(e,"useSwitchChain() must be used within a <ThirdwebProvider/>"),e.setConnectedWallet}let q="tw-cache";function D(e){return[q,...e.filter(e=>"string"!=typeof e||e!==q)]}let J={auth:{user:()=>D(["user"])},network:{active:e=>D(["chainId",e])},wallet:{balance:(e,t,n)=>{var r;return D((r=D(["balance",{walletAddress:t,tokenAddress:n}]),D(J.network.active(e).concat(r))))}}},K="auth_token_storage_key";function R(){let e=(0,i.NL)(),t=b(),n=L(),r=(0,a.D)({mutationFn:async()=>{let r;(0,s.Z)(t,"Please specify an authConfig in the ThirdwebProvider"),(0,s.Z)(n,"You need a connected wallet to login."),(0,s.Z)(t.authUrl,"Please specify an authUrl in the authConfig.");let i=await n.getAddress(),a=await n.getChainId(),o=await fetch(`${t.authUrl}/payload`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:i,chainId:a.toString()})});if(!o.ok)throw Error(`Failed to get payload with status code ${o.status}`);try{({payload:r}=await o.json())}catch{throw Error("Failed to get payload")}let c=await (0,u.s)({wallet:n,payload:r});if(!(o=await fetch(`${t.authUrl}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payload:c}),credentials:"include"})).ok){let e=await o.json();if(e.error)throw Error(e.error);throw Error(`Login request failed with status code ${o.status}`)}let{token:l}=await o.json();return await t.secureStorage?.setItem(K,l),e.invalidateQueries(J.auth.user()),l}});return{login:()=>r.mutateAsync(),isLoading:r.isLoading}}function Q(){let e=(0,i.NL)(),t=b(),n=(0,a.D)({mutationFn:async()=>{(0,s.Z)(t,"Please specify an authConfig in the ThirdwebProvider"),(0,s.Z)(t.authUrl,"Please specify an authUrl in the authConfig."),await fetch(`${t.authUrl}/logout`,{method:"POST",credentials:"include"}),t.secureStorage?.removeItem(K),e.invalidateQueries(J.auth.user())}});return{logout:n.mutateAsync,isLoading:n.isLoading}}function Y(){let e=b(),{data:t,isLoading:n}=(0,o.a)(J.auth.user(),async()=>{(0,s.Z)(e,"Please specify an authConfig in the ThirdwebProvider"),(0,s.Z)(e.authUrl,"Please specify an authUrl in the authConfig.");let t=await e.secureStorage?.getItem(K),n={credentials:"include",...t?{headers:{Authorization:`Bearer ${t}`}}:{}},r=await fetch(`${e.authUrl}/user`,n);return await r.json()},{enabled:!!e});return{user:t,isLoggedIn:!!t,isLoading:n}}let z=e=>{let{value:t,children:n}=e,r=(0,l.useMemo)(()=>{if(!t)return;let e={...t,authUrl:t.authUrl?.replace(/\/$/,"")};return e},[t]);return(0,f.jsxs)(y.Provider,{value:r,children:[n,(0,f.jsx)(B,{})]})};function B(){let e=L(),{logout:t}=Q(),{switchAccount:n}=function(){let e=(0,i.NL)(),t=b(),n=(0,a.D)({mutationFn:async n=>{(0,s.Z)(t,"Please specify an authConfig in the ThirdwebProvider"),(0,s.Z)(t.authUrl,"Please specify an authUrl in the authConfig."),await fetch(`${t.authUrl}/switch-account`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:n})}),e.invalidateQueries(J.auth.user())}});return{switchAccount:n.mutateAsync,isLoading:n.isLoading}}(),r=b(),o=(0,i.NL)();return(0,l.useEffect)(()=>{let i=async e=>{if(e.address)try{await n(e.address)}catch(t){console.debug(`[Auth] Failed to switch account to ${e.address} with error:
`,t)}},a=async()=>{try{await t()}catch(e){console.debug(`[Auth] Failed to logout with error:
`,e)}},o=!!e&&r&&r.authUrl;return o&&(e.addListener("connect",i),e.addListener("change",i),e.addListener("disconnect",a)),()=>{o&&(e.removeListener("connect",i),e.removeListener("change",i),e.removeListener("disconnect",a))}},[e,o,r,t,n]),null}function H(e,t,n){let r=(0,l.useMemo)(()=>e.map(e=>(0,w.nRj)(e,n)),[e,n]),i=(0,l.useMemo)(()=>t&&"string"!=typeof t&&"number"!=typeof t?(0,w.nRj)(t,n):t,[t,n]);return[r,i]}let V=e=>{let{queryClient:t,children:n}=e,r=(0,l.useMemo)(()=>t||new c.S,[t]);return(0,f.jsx)(i.aH,{client:r,children:n})},G=(0,l.createContext)(void 0),X=e=>{let{value:t,children:n}=e;return(0,f.jsx)(G.Provider,{value:t,children:n})},ee=(0,l.createContext)({});function et(){let{sdk:e}=function(){let e=(0,l.useContext)(ee);return(0,s.Z)(e._inProvider,"useSDK must be called from within a ThirdwebProvider, did you forget to wrap your app in a <ThirdwebProvider />?"),e}();return e}let en={wallet:void 0,address:void 0,chainId:void 0,signer:void 0},er=(0,l.createContext)(void 0),ei=e=>{let{signer:t,children:n}=e,{chains:r,clientId:i}=function(){let e=(0,l.useContext)(G);return(0,s.Z)(e,"useThirdwebConfigContext() hook must be used within a <ThirdwebProvider/>"),e}(),a=et()?.storage,[o,c]=(0,l.useState)({...en,signer:t||void 0});return(0,l.useEffect)(()=>{c(e=>({...e,signer:t||void 0}))},[t]),(0,l.useEffect)(()=>{if(!a)return;let e=t;return t?Promise.all([t.getAddress(),t.getChainId()]).then(n=>{let o,[u,s]=n,l=r.find(e=>e.chainId===s);if(l)try{o=(0,w.OZ$)(l,i)[0]}catch(e){console.error(e)}if(t===e){let e=new v.U(t,{readonlySettings:o?{rpcUrl:o,chainId:s}:void 0},a);c({wallet:e,address:u,chainId:s,signer:t})}}).catch(e=>{}):c(en),()=>{e=void 0}},[t,i]),(0,f.jsx)(er.Provider,{value:o,children:n})},ea=e=>{let{sdkOptions:t={},storageInterface:n,supportedChains:r,activeChain:i,signer:a,children:o,clientId:c,secretKey:u}=e,s=(0,l.useMemo)(()=>i?"number"==typeof i?i:"string"==typeof i?r.find(e=>e.slug===i)?.chainId:i.chainId:r[0]?.chainId,[i,r]),d=(0,l.useMemo)(()=>{let e,i,a=s,o=r.find(e=>e.chainId===a);if(o||void 0===a||(console.warn(`The chainId ${a} is not in the configured chains, please add it to the ThirdwebProvider`),a=void 0),o&&o.rpc.length>0)try{let t=(0,w.OZ$)(o,c)[0];e={chainId:o.chainId,rpcUrl:t}}catch(e){}let l={readonlySettings:e,...t,supportedChains:r};if(a&&(i=new g.x9T(a,{...l,clientId:c,secretKey:u},n)),!i){if(r.length>0)a=r[0].chainId,i=new g.x9T(a,l,n);else{console.error("No chains configured, please pass a chain or chains to the ThirdwebProvider");return}}return i._chainId=a,i},[s,r,t,n,c,u]);(0,l.useEffect)(()=>{d&&d._chainId===s&&(a?d.updateSignerOrProvider(a):s&&d.updateSignerOrProvider(s))},[d,d?._chainId,a,s]);let h=(0,l.useMemo)(()=>({sdk:d&&d._chainId===s?d:void 0,_inProvider:!0}),[s,d]);return(0,f.jsx)(ee.Provider,{value:h,children:o})},eo=e=>{let{signer:t,children:n,queryClient:r,supportedChains:i,activeChain:a,clientId:o,...c}=e;o||(0,v.c)("No API key. Please provide a clientId. It is required to access thirdweb's services. You can create a key at https://thirdweb.com/create-api-key",o,void 0);let u=i||w.gL9,s=(0,l.useMemo)(()=>{let e="object"==typeof a&&null!==a;if(!e)return u;let t=u.find(e=>e.chainId===a.chainId);return t?u.map(e=>e.chainId===a.chainId?a:e):[...u,a]},[u,a]),[d,h]=H(s,a||s[0],o),g=(0,l.useMemo)(()=>{if(!h||"string"==typeof h||"number"==typeof h)return d;let e=[...d.filter(e=>e.chainId!==h.chainId),h];return e.filter((e,t,n)=>t===n.findIndex(t=>t.chainId===e.chainId))},[d,h]);return(0,f.jsx)(X,{value:{chains:g,clientId:o},children:(0,f.jsx)(V,{queryClient:r,children:(0,f.jsx)(ea,{signer:t,supportedChains:g,clientId:o,activeChain:h,...c,children:(0,f.jsx)(ei,{signer:t,children:n})})})})},ec=e=>{let{createWalletStorage:t=m.c,...n}=e,{activeChain:r}=n,i=n.supportedChains||w.gL9,a=(0,l.useMemo)(()=>{let e="object"==typeof r&&null!==r;if(!e)return i;let t=i.find(e=>e.chainId===r.chainId);return t?i.map(e=>e.chainId===r.chainId?r:e):[...i,r]},[i,r]),[o,c]=H(a,n.activeChain||a[0],n.clientId),u=(0,l.useMemo)(()=>{if("number"==typeof c){let e=o.find(e=>e.chainId===c);if(!e)throw Error(`Invalid chainId: ${c}. It is not one of supportedChains`);return e}if("string"==typeof c){let e=o.find(e=>e.slug===c);if(!e)throw Error(`Invalid chain: "${c}". It is not one of supportedChains`);return e}return c},[c,o]),s=n.dAppMeta;return(0,f.jsx)(C.Provider,{value:n.theme,children:(0,f.jsx)(T,{chains:o,supportedWallets:n.supportedWallets,shouldAutoConnect:n.autoConnect,createWalletStorage:t,dAppMeta:s,activeChain:u,autoSwitch:n.autoSwitch,autoConnectTimeout:n.autoConnectTimeout,clientId:n.clientId,activeChainSetExplicitly:!!n.activeChain,signerWallet:n.signerWallet,children:(0,f.jsx)(eu,{queryClient:n.queryClient,sdkOptions:n.sdkOptions,supportedChains:o,activeChain:u,storageInterface:n.storageInterface,authConfig:n.authConfig,clientId:n.clientId,secretKey:n.secretKey,children:(0,f.jsx)(z,{value:n.authConfig,children:n.children})})})})},eu=e=>{let{children:t,...n}=e,r=W()?.signer;return(0,f.jsx)(eo,{signer:r,...n,children:t})};function es(){let e=(0,l.useContext)(G);return(0,s.Z)(e,"useSupportedChains() hook must be used within a <ThirdwebProvider/>"),e.chains}function el(e){let t=ed(),{wallet:n,address:r,chainId:i}=function(){let e=(0,l.useContext)(er);return(0,s.Z)(e,"useThirdwebConnectedWalletContext() hook must be used within a <ThirdwebProvider/>"),e}(),a=(0,l.useMemo)(()=>J.wallet.balance(i||-1,r,e),[i,e,r]);return(0,o.a)(a,()=>n?.balance(e),{enabled:!!n&&!!t&&!!i,retry:!0,keepPreviousData:!1})}function ed(){let e=(0,l.useContext)(er);return(0,s.Z)(e,"useAddress() hook must be used within a <ThirdwebProvider/>"),e.address}function eh(){let e=(0,l.useContext)(er);return(0,s.Z)(e,"useChainId() hook must be used within a <ThirdwebProvider/>"),e.chainId}function ef(){let e=eh(),t=es(),n=(0,l.useMemo)(()=>t.find(t=>t.chainId===e),[e,t]),r=(0,l.useMemo)(()=>{if(!n)return w.gL9.find(t=>t.chainId===e)},[e,n]);return n||r}function ew(){let e=et();return e?.storage}function eg(){let e=eh(),t=function(){let e=et();return e?._chainId}();return!!t&&-1!==t&&!!e&&t!==e}function ev(){let e=ed(),t=es(),{clientId:n}=W(),r=t.find(e=>1===e.chainId);return(0,o.a)({queryKey:["ens",e,r?.rpc],cacheTime:864e5,staleTime:36e5,retry:!1,enabled:!!e,queryFn:async()=>{if(!e)return null;let t=(0,g.rV4)(1,{clientId:n,supportedChains:r?[{chainId:1,rpc:[...r.rpc],nativeCurrency:r.nativeCurrency,slug:r.slug}]:void 0});if(t instanceof d.r){let[n,r]=await Promise.all([t.lookupAddress(e),t.getAvatar(e)]);return{ens:n,avatarUrl:r}}return{ens:await t.lookupAddress(e),avatarUrl:null}}})}function ep(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return`${e.substring(0,t?4:6)}...${e.substring(e.length-(t?3:4))}`}function em(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(!e)return"";try{let n=h.getAddress(e);return ep(n,t)}catch{return e}}}}]);